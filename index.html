<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Status: Idle</title>
    <style>
        /* --- THEME --- */
        :root { --bg: #0a0a0a; --card: #111; --text: #eee; --accent: #ff0055; --blue: #00ccff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Courier New', monospace; overflow: hidden; }

        /* --- GHOST SCREEN --- */
        #ghost-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 100; background: var(--bg); display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1s; }
        .quote { font-size: 1.2rem; color: #666; animation: breathe 3s infinite; text-align: center; padding: 20px;}
        @keyframes breathe { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

        /* --- DASHBOARD --- */
        #dashboard { display: none; padding: 20px; height: 100vh; overflow-y: auto; }
        .header { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--card); border: 1px solid #333; padding: 20px; border-radius: 8px; }
        .card h3 { color: #888; font-size: 0.9rem; margin-top: 0; text-transform: uppercase; }
        .value { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }
        .sub { font-size: 0.8rem; color: var(--blue); }

        /* --- PRODUCT LIST --- */
        .prod-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #222; }
        .prod-name { color: #aaa; }
        .prod-val { color: #fff; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ghost-layer">
        <div id="quote-text" class="quote">"System checks in progress..."</div>
    </div>

    <div id="dashboard">
        <div class="header">
            <h1>PINK-BLUE ANALYTICS /// STEALTH</h1>
            <div style="color: var(--accent)">SECURE</div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>Today's Revenue</h3>
                <div id="rev-val" class="value">Loading...</div>
                <div id="rev-sub" class="sub">Fetching live Magento data...</div>
            </div>

            <div class="card" style="border-color: var(--blue)">
                <h3>AI Revenue Forecast (30 Days)</h3>
                <div id="ai-val" class="value">...</div>
                <div id="ai-sub" class="sub">Computing Regression Model...</div>
            </div>

            <div class="card">
                <h3>Order Health</h3>
                <div id="ord-val" class="value">0</div>
                <div class="sub">COD vs Online split loading...</div>
            </div>

            <div class="card">
                <h3>Top Selling Today</h3>
                <div id="prod-list"></div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const SECRET = "pinkblueanalytics109";
        const QUOTES = [
            "Experience is the name everyone gives to their mistakes.",
            "Java is to JavaScript what car is to Carpet.",
            "It works on my machine.",
            "I have not failed. I've just found 10,000 ways that won't work."
        ];

        // --- GHOST LOGIC ---
        let buffer = "";
        const ghost = document.getElementById('ghost-layer');
        const dash = document.getElementById('dashboard');

        // Rotate Quotes
        setInterval(() => {
            document.getElementById('quote-text').innerText = QUOTES[Math.floor(Math.random() * QUOTES.length)];
        }, 4000);

        // Key Listener
        document.addEventListener('keydown', (e) => {
            if(e.key === "Enter") {
                if(buffer.endsWith(SECRET)) unlock();
                buffer = "";
            } else if(e.key.length === 1) {
                buffer += e.key;
            }
        });

        function unlock() {
            ghost.style.opacity = 0;
            setTimeout(() => {
                ghost.style.display = 'none';
                dash.style.display = 'block';
                loadAllData(); // Trigger the API calls
            }, 1000);
        }

        // --- DASHBOARD LOGIC ---
        async function loadAllData() {
            try {
                // 1. Get Overview
                const res1 = await fetch('/api?type=overview');
                const overview = await res1.json();
                
                document.getElementById('rev-val').innerText = "₹" + (overview.revenue || 0).toLocaleString();
                document.getElementById('rev-sub').innerText = `${overview.orders} Orders processed`;
                
                document.getElementById('ord-val').innerText = overview.orders;
                document.querySelector('.sub').innerText = `COD: ${overview.cod_orders} | Online: ${overview.online_orders}`;

                // 2. Get AI Forecast
                const res2 = await fetch('/api?type=ai-forecast');
                const ai = await res2.json();
                document.getElementById('ai-val').innerText = "₹" + (ai.prediction_next_30_days || 0).toLocaleString();
                document.getElementById('ai-sub').innerText = `Confidence: ${ai.confidence} | Trend: ${ai.trend}`;

                // 3. Get Products
                const res3 = await fetch('/api?type=products');
                const prod = await res3.json();
                const list = document.getElementById('prod-list');
                list.innerHTML = "";
                (prod.top_products || []).forEach(p => {
                    list.innerHTML += `<div class="prod-row"><span class="prod-name">${p.name.substring(0,20)}...</span><span class="prod-val">${p.qty}</span></div>`;
                });

            } catch (err) {
                console.error(err);
                alert("API Error: Check Console");
            }
        }
    </script>
</body>
</html>
